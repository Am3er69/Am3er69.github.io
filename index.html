<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Signal Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        background: #0f0f0f;
        color: white;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    #statusBar {
        padding: 14px;
        font-size: 15px;
        background: #1c1c1c;
        border-bottom: 1px solid #333;
        text-align: center;
    }

    #signalContainer {
        padding: 15px;
    }

    .signal-card {
        background: #1b1b1b;
        padding: 15px;
        margin: 12px 0;
        border-radius: 12px;
        border: 1px solid #333;
        box-shadow: 0 0 12px rgba(0,0,0,0.4);
        transition: 0.2s ease-in-out;
    }

    .signal-card:hover {
        transform: scale(1.02);
    }

    .pair {
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 4px;
    }

    .direction {
        font-size: 18px;
        margin-top: 5px;
        font-weight: bold;
    }

    .confidence {
        margin-top: 8px;
        font-size: 16px;
        color: #d0d0d0;
    }

    .details {
        margin-top: 12px;
        font-size: 14px;
        line-height: 1.5;
        color: #cfcfcf;
    }

    .timestamp {
        margin-top: 10px;
        font-size: 12px;
        opacity: 0.6;
        text-align: right;
        padding-right: 4px;
    }

    .no-signal {
        text-align: center;
        margin-top: 40px;
        font-size: 18px;
        opacity: 0.7;
    }
</style>
</head>

<body>

<div id="statusBar">Loading signalsâ€¦</div>
<div id="signalContainer"></div>

<script>
// ------------------------------
// FRONTEND CONFIG
// ------------------------------
const API_URL = "http://localhost:3000";
const MIN_CONFIDENCE = 65;

// ------------------------------
// DOM ELEMENTS
// ------------------------------
const signalContainer = document.getElementById("signalContainer");
const statusBar = document.getElementById("statusBar");

// ------------------------------
// FETCH LIVE SIGNALS
// ------------------------------
async function fetchSignals() {
    try {
        statusBar.innerText = "Fetching signalsâ€¦";

        const res = await fetch(`${API_URL}/signals`);
        const data = await res.json();

        statusBar.innerText = `Last Updated: ${new Date().toLocaleTimeString()}`;

        renderSignals(data.signals || []);

    } catch (err) {
        console.error(err);
        statusBar.innerText = "Error fetching signals (Backend Offline?)";
    }
}

// ------------------------------
// RENDER SIGNAL CARDS
// ------------------------------
function renderSignals(signals) {
    signalContainer.innerHTML = "";

    const filtered = signals.filter(s => s.confidence >= MIN_CONFIDENCE);

    if (filtered.length === 0) {
        signalContainer.innerHTML = `
            <div class="no-signal">No high-confidence signals (â‰¥ ${MIN_CONFIDENCE}%)</div>
        `;
        return;
    }

    filtered.forEach(sig => {
        const card = document.createElement("div");
        card.className = "signal-card";

        const arrow = sig.direction === "BUY" ? "ðŸ“ˆ" : "ðŸ“‰";
        const color = sig.direction === "BUY" ? "#1eae60" : "#d9534f";

        card.innerHTML = `
            <div class="pair">${sig.symbol}</div>
            <div class="direction" style="color:${color}">${arrow} ${sig.direction}</div>
            <div class="confidence">Confidence: <b>${sig.confidence}%</b></div>

            <div class="details">
                <div>Entry: ${sig.entry}</div>
                <div>Stop Loss: ${sig.stopLoss}</div>
                <div>TP1: ${sig.tp1}</div>
                <div>TP2: ${sig.tp2}</div>
                <div>TP3: ${sig.tp3}</div>
            </div>

            <div class="timestamp">
                Generated: ${new Date(sig.timestamp).toLocaleTimeString()}
            </div>
        `;

        signalContainer.appendChild(card);
    });
}

// ------------------------------
// AUTO REFRESH (every 10 seconds)
// ------------------------------
setInterval(fetchSignals, 10000);
fetchSignals();
</script>

</body>
</html>
